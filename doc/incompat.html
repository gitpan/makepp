<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>Incompatibliities between Make and Makepp</title>
  </head>

  <body>
    <h1>Incompatibliities between Make and Makepp</h1>

    <p><i>makepp</i> was designed to be as close as possible to GNU
    make.  However, because of the <a
    href="build_algorithm.html">difference in philosophy</a>, some of
    GNU make's features cannot be supported; others have not been
    implemented because I haven't had time.  Also, in order to emulate
    GNU make's behavior precisely, you may in some cases have to add
    additional command line options to the <i>makepp</i> command line,
    as noted below.  Most of the differences from GNU make are quite
    technical and only rarely cause problems.</p>

    <p><i>Makepp</i> will give warning messages for many things which
    the traditional unix make accepts without flinching.  This is
    because there are better ways to do them with <i>makepp</i>.  If
    these warnings annoy you, you can turn them off with the <a
    href="command_line.html#option_nowarn"><code>--nowarn</code></a>
    command line option.</p>

    <h2>Incompatibilities for all options</h2>

    <ul>
      <li>
	The <code>VPATH</code> variable is currently ignored.
	<code>vpath</code> statements are unsupported and will cause
	errors.  Use <a href="repositories.html">repositories</a>
	instead.

	<a name="pattern_rule_dirs"></a>
      <li>Pattern rules only match files in the directory (or if you
      include the <a
      href="#percent_subdirs"><code>--percent-subdirs</code></a> option,
      in its subdirectories).  This means that a rule like this:
<pre>
%.o: %.c
	$(CC) $(CFLAGS) -c $(input) -o $(output)
</pre>
	<p>will not be applied to files like
	<code>../shared/xyz.c</code>.</p>

      <li>A pattern rule present later in a makefile overrides one that
	is present earlier.  This is backwards from GNU make.

      <li>
	Default rules (pattern rules with no pattern dependencies) are
	not supported.

      <li>
	The set of <a href="builtin.html">builtin implicit rules</a> is
	somewhat different from those for GNU make, though the variable
	names are largely compatible.  The builtin rules should
	successfully compile C/C++/Fortran programs, and in fact may be
	able to guess the proper libraries in some cases too.  Support
	for Modula-2 and RatFor and other rare languages is deliberately
	not present, because I kept running into problems with GNU
	make's rules when I accidently reused the extensions for those
	languages.

      <li>
	Archive members are not supported, and neither are the
	associated automatic variables <code>$%</code>,
	<code>$(%D)</code>, and <code>$(%F)</code>.

	<a name="function_if">

      <li>Leading and trailing whitespace in variable assignments is
      ignored (even if the whitespace is followed by a comment).  For
      more details on whitespace handling incompatibilities, see the
      section on <a
      href="#norc_substitution"><code>--norc-substitution</code></a>.

      <li>
	Double colon rules are not currently supported; they are treated
	as single colon rules.  Because of the way <i>makepp</i> is
	implemented, they will probably never be supported.

      <li>
	<i>Makepp</i> does not attempt to rebuild files included with
	the <code>include</code> statement unless the makefile contains
	a rule for building them before the include statement is seen.
	(It will attempt to rebuild the makefile itself, however.)

      <li>
	The <code>SHELL</code> variable is currently ignored.
	<i>makepp</i> always uses <code>/bin/sh</code>.


      <li>
	Dependencies of anything on the Makefile still work, but are
	usually unnecessary.  This is usually used to force a rebuild
	when compilation options change.  <i>makepp</i> knows when build
	commands have changed without anything special in the makefile;
	it stores this on a file-by-file basis.  If you change the
	makefile, it knows exactly which files need recompilation.

      <li>
	<code>$?</code> is equivalent to <code>$+</code>.  See the
	section on <a href="syntax_makefile.html#var_quesmark">automatic
	variables</a> for the reasons.

      <li>
	Intermediate files are not deleted.  (Because <i>makepp</i>
	insists on having all of the file dates be the same as they were
	on the last build, intermediate files must all be present or
	else rebuilds will occur.)  There is no special status accorded
	to intermediate files.  This means that the special targets
	<code>.INTERMEDIATE</code>, <code>.SECONDARY</code>, and
	<code>.PRECIOUS</code> are ignored.

      <li>
	<p>The only special target that is supported is
	<code>.PHONY</code>.  The remaining are simply ingored.</p>

	<p>Specifically, GNU make has the following special targets:</p>

	<dl>
	 <dt><code>.SUFFIXES</code>
	  <dd>
	    <i>Makepp</i> ignores <code>.SUFFIXES</code> except for the
	    special case of <code>.SUFFIXES</code> with no dependencies,
	    like this:
<pre>
.SUFFIXES:
</pre>
	    <p>which tells it not to load any of its <a
	    href="builtin.html">default rules</a>.</p>

	  <dt><code>.INTERMEDIATE</code>, <code>.SECONDARY</code>, <code>.PRECIOUS</code>
	  <dd>
	    No special status is accorded to intermediate files and so
	    these targets are not meaningful.

	  <dt><code>.IGNORE</code>
	  <dd>
	    Put the word <code>ignore_error</code> (or a minus sign) in front
	    of the command whose exit status is to be ignored.

	  <dt><code>.SILENT</code>
	    Put the word <code>noecho</code> (or the <code>@</code>
	    character) in front of the command which is not supposed to
	    be echoed.

	  <dt><code>.DELETE_ON_ERROR</code>
	  <dt><code>.EXPORT_ALL_VARIABLES</code>
	  <dt><code>.NOEXPORT</code>
	    These targets are not supported and are simply ignored.

	  <dt><code>.POSIX</code>
	  <dt><code>.DEFAULT</code>
	  <dd>
	    These targets are simply ignored.
	</dl>


      <li>
	Several GNU make functions are not currently supported.  These
	are <code>origin</code>, <code>call</code>,
	<code>error</code>, and <code>warning</code>.

      <li>The <code>$(wildcard&nbsp;)</code> function matches not only
      files which exist, but also files which do not yet exist, but
      which have a rule which <i>makepp</i> has seen at the time the
      <code>$(wildcard&nbsp;)</code> function is evaluated.

      <li>
	The <code>override</code> statement is not supported.

      <li>
	<code>-include</code> will not attempt to make the include file
	if it doesn't exist.  Also, if the file exists but is out of
	date with respect to its dependencies, it will not be remade; it
	is not considered an implicit target.

	<p>This is usually used for files containing dependency
	information, and since <i>makepp</i> is able to compute a lot of
	this without depending on additional tools,
	<code>-include</code> is not as important as it used to be.</p>

	<p>The makefile itself is ordinarily considered an implicit
	target.  It will be rebuilt and reread if any of its
	dependencies have changed since the last time <i>makepp</i>
	rebuilt it.</p>

      <li>
	"Canned command sequences" (strings defined with the
	<code>define</code> statement) are not supported.

      <li><i>Makepp</i> does not support the following environment
	variables (it does not set them up, and it just ignores them):
	<ul>
	  <li><code>MAKEOVERRIDES</code>
	  <li><code>MFLAGS</code>
	  <li><code>MAKELEVEL</code>
	  <li><code>MAKEFILES</code>
	</ul>

      <li>
    </ul>

    <a name="percent_subdirs"></a>
    <h2>Incompatibilities without the --percent-subdirs option</h2>

    <p>By default, <code>%</code> in a pattern rule does not match
    directories.  Thus <code>%.c</code> matches only <code>.c</code>
    files in the current directory.  If you want it to match files in
    subdirectories too, then add the <code>--percent-subdirs</code>
    option to the command line.</p>

    <h2>Incompatibilities without the -m option</h2>

    <p>By default, <i>makepp</i> will attempt to rebuild all targets <a
    href="signature_checking.html">if any of the dependencies have
    changed since the last build, or if the command has changed</a>.
    This is normally what you want.  Sometimes, however, you don't want
    the target to be rebuilt if it has been modified apart from the
    control of <i>makepp</i> (e.g., by editing it, or by running a
    program manually to make the file).  You can force <i>makepp</i> to
    use the traditional make algorithm, which only rebuilds if any of
    the targets are newer than the dependencies, by adding the option <a
    href="command_line.html#option_signature_method"><code>-m&nbsp;target_newer</code></a>
    to the command line.</p>

    <p>As a special exception, any targets which are built while
    rebuilding the makefile are automatically checked using the
    <code>target_newer</code> method in order to avoid problems with
    configure procedures.</p>

    <a name="traditional_recursive_make"></a>

    <h2>Incompatibilities without the --traditional-recursion
      option</h2>

    <p>Recursive invocations of make are often considered to be an
    unsafe practice (see the <a
    href="legacy_makefiles.html#recursive_make">section on recursive
    make in the discussion of deprecated idioms</a>), but they are
    extremely common in existing makefiles.  <i>Makepp</i> supports
    recursive make for backward compatibility; for new makefiles, it is
    much better to use the <a
    href="syntax_makefile#load_makefile_statement"><code>load_makefile</code></a>
    statement, or <i>makepp</i>'s implicit makefile loading
    mechanism.</p>

    <p>Sometimes recursive make invocations set variables on the command
      line:</p>
<pre>
target: dependencies
	cd subdir && $(MAKE) VAR=val VAR2=val2 some-other-target
</pre>

    <p>If you do this, you may have to add the <a
    href="command_line.html#option_noimplicit_load"><code>--noimplicit-load</code></a>
    option to the command line to avoid conflicts between what the
    parent process and the child process think the build rules are.</p>

    <p>In order to be able to use repositories for variant builds, and
    to help make recursive invocations of make safter, <i>makepp</i>
    normally does not actually invoke itself recursively even if you
    tell it to.  Instead, a subprocess communicates with the parent
    process, and the actual build is done by the parent process.</p>

    <p>This works in most cases, but there are a few incompatibilities.
    (All of these incompatibilities are removed by adding the <a
    href="command_line.html#option_traditional_recursive_make"><code>--traditional-recursive-make</code></a>
    option to the command line.)</p>

    <ul>
      <li>You may not invoke several makefiles from the same directory,
	e.g., the following will not work:
<pre>
target: dependencies
	$(MAKE) -f other_makefile targets
</pre>
	<p>However, this will work:
<pre>
target: dependencies
	cd subdir && $(MAKE) -f other_makefile targets
</pre>

      <li>Changes in environment variables are not passed to the
      recursive make process; the environment of the parent is used
      instead.

      <li>The <code>MAKEFLAGS</code> variable is not set up, and
	altering it has no effect.
    </ul>

    <p>This may seem like a long list of restrictions, but many
    makefiles obey them.  For example, as far as I know, all makefiles
    produced by <code>automake</code> follow these restrictions.</p>

    <p>All of these restrictions go away if you add the
    <code>--traditional-recursive-make</code> option to the command
    line, but that has the following undesirable side effects:</p>

    <ul>
      <li>Recursive makes do not execute in parallel, even if the parent
	does.
      <li>Recursive make processes do not know anything about repositories.
      <li>Each recursive make process produces its own log file, in the
	directory it is invoked in, instead of producing one log file
	for the entire build.
    </ul>

    <p>Even with the <code>--traditional-recursive-make</code> option,
      there are a few remaining incompatibilities:</p>
    <ul>
      <li>The environment variables <code>MAKEOVERRIDES</code> and
      <code>MFLAGS</code> not set up, and are ignored.
    </ul>

    <a name="norc_substitution"></a>
    <h2>Incompatibilities without the --norc-substitution option</h2>

    <p><a href="syntax_makefile.html#substitution">Rc-style
    substitution</a> is the default way <i>makepp</i> performs variable
    substitution into text strings because it very rarely breaks legacy
    makefiles and is often useful in new makefiles.  However, it does
    introduce occasional incompatibilities in the substitution of
    variables not surrounded by spaces.  For example,</p>

<pre>
INCLUDE_PREFIX := -I/some/include/dir -I
INCLUDES := $(INCLUDE_PREFIX)/other/include/dir
</pre>

    <p>will set <code>INCLUDES</code> to
    <pre>-I/some/include/dir/other/include/dir&nbsp;-I/other/include/dir</pre>
    if rc-style substitution is enabled, whereas GNU make would set it
    to <pre>-I/some/include/dir&nbsp;-I/other/include/dir</pre>

    <p>There is also an incompatibility in the handling of whitespace in
      a variable:</p>

<pre>
null :=
T := -o $(null)		# T contains -o followed by one space.
OUTFILE = $(T)outfile
</pre>

    <p>will set <code>OUTFILE</code> to <code>-ooutfile</code> if
    rc-style substitution is enabled, whereas GNU make would set it to
    <code>-o&nbsp;outfile</code>.

    <p>Both of these incompatibilities are removed by the <a
    href="command_line.html#norc_substitution"><code>--norc-substitution</code></a>
    option.  Note, however, that even with
    <code>--norc-substitution</code>, makepp still treats whitespace
    incompatibly in some situations:</p>

<pre>
T := -o # Don't delete this comment.
</pre>

    <p>GNU make sets <code>T</code> to contain <code>-o</code> followed
    by a space, whereas <i>makepp</i> strips out the trailing space
    anyway.  If you want the trailing space, you must specify
    <code>--norc-substitution</code> and also set <code>T</code> using
    the technique involving a dummy variable such as <code>null</code>,
    as shown above.</p>
    

    <h2>Command line incompatibilities</h2>

    <p>At present, you may not combine single character options into a
    single word.  E.g., you may not say
    <code>makepp&nbsp;-ejk&nbsp;2</code> instead of
    <code>makepp&nbsp;-e&nbsp;-j&nbsp;2&nbsp;-k</code>.</p>

    <p><i>Makepp</i> supports a few of make's more useful command line
      options.  The following, however, are not supported, and are
      ignored after a warning message is printed:</p>

    <ul>
      <li><code>-d</code> (<code>--debug</code>)
      <li><code>-i</code>
      <li><code>-I</code>
      <li><code>-l</code> (<code>--load-average</code> or
	<code>--max-load</code>)
      <li><code>-n</code> (<code>--just-print</code>,
	<code>--dry-run</code>, or <code>--recon</code>)
      <li><code>-o</code> (<code>--old-file</code> or
	<code>--assume-old</code>)
      <li><code>-p</code> (<code>--print-data-base</code>)
      <li><code>-q</code> (<code>--question</code>)
      <li></code>-r</code> (<code>--no-builtin-rules</code>)
	<br>(Note that <i>makepp</i> never has any builtin rules.)
      <li><code>-R</code> (<code>--no-builtin-variables</code>)
	<br>(Note that <i>makepp</i> never has any builtin
	variables.)
      <li><code>-S</code> (<code>--no-keep-going</code> or <code>--stop</code>)
      <li><code>-t</code> (<code>--touch</code>)
      <li><code>-w</code> (<code>--print-directory</code>)
      <li><code>--no-print-directory</code>
      <li><code>-W</code> (<code>--what-if</code> or
	<code>--new-file</code> or <code>--assume-new</code>)
      <li><code>--warn-undefined-variables</code>
    </ul>

    <p>Some of these can be easily supported if anyone cares.</p>

    <p>Note that the <code>-q</code> option at present actually does
      something different--it suppresses some of <i>makepp</i>'s chatty
      informational messages.</p>

    <p>The <code>-m</code> option also has a different function.</p>

    <hr>
    <a href="index.html">Table of contents</a>
    |
    <a href="bugs.html">Next (bugs)</a>
    |
    <a href="legacy_makefiles.html">Previous (using/converting old makefiles)</a>
    <br>

<!-- Created: Wed Aug  9 21:44:55 PDT 2000 -->
<!-- hhmts start -->
Last modified: Mon Feb 19 20:23:56 PST 2001
<!-- hhmts end -->
  </body>
</html>
